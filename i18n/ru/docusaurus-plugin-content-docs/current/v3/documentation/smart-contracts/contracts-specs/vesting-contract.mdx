# Вестинговый контракт

Этот контракт позволяет вам заблокировать определенное количество Тонкона на определенное время и постепенно разблокировать их.

## Параметры вложения

Параметры вестинга не изменены и заданы при развертывании.

`vesting_total_amount` - в нанотонах, общее количество заблокированных Toncoins.

`vesting_start_time` - unixtime, отправная точка периода vesting, до этого момента, пока `vesting_total_amount` не будет заблокирован, после чего он начнет разблокироваться в соответствии с другими параметрами.

`vesting_total_duration` - общая продолжительность вестинга в секундах (например, `31104000` за один год).

`unlock_period` - период разблокировки в секундах (например, `2592000` за один месяц).

`cliff_duration` - начальный период скала в секундах (например, `5184000` за 2 месяца).

`vesting_sender_address` - адрес, на который вы можете вернуть Toncoins (даже если они заблокированы) в любое время; также этот адрес может добавить белый список.

`owner_address` - тот, кому было выдано вестинг, по этому адресу, он может инициировать отправку Toncoins из контракта вестинга.

Эти параметры можно получить через `get_vesting_data()` get-method.

Параметры должны удовлетворять следующим условиям:

```
vesting_total_duration > 0
vesting_total_duration <= 135 лет (2^32 секунды)
разблокировать_период > 0
разблокировать_период <= vesting_total_duration
cliff_duration >= 0
cliff_duration < vesting_total_duration
vesting_total_duration mod unlock_period == 0
cliff_duration mod unlock_period == 0 

```

Хотя смарт-контракт не проверяет на соответствие этим условиям, после того, как контракт развернут и перед отправкой Toncoins к нему, пользователь может проверить, что все параметры OK по get-методу.

## Заблокировать

Перед `vesting_start_time`, все `vesting_total_amount` заблокированы.

Начиная с `vesting_start_time` сумма начинает разблокировать пропорционально.

Например, если `vesting_total_duration` составляет 10 месяцев, а `unlock_period` - 1 месяц, и `vesting_total_amount` 500 TON каждый месяц разблокирует 500\*(10/100)=50 TON, и через 10 месяцев все 500 TON будут разблокированы.

Если существует период скалы, ничего не разблокировано в этот период скал, и после того, как он прошел, сумма разблокируется по приведенной выше формуле.

Например, если «cliff_period» составляет 3 месяца, а остальные параметры аналогичны предыдущему примеру. то первые 3 месяца ничего не будет разблокировано и на 3 месяца 150 TON будут разблокированы один раз (и затем 50 TON каждый месяц).

Get-method `get_locked_amount(int at_time)` позволяет рассчитать, сколько будет заблокировано в определенный момент времени.

Вы можете отправлять заблокированные Toncoins только адресам белого списка или `vesting_sender_address`.

Вы можете отправлять открытые Toncoins в любом месте и в любое время.

## Белый список

Белый список - это список адресов, на которые вы можете отправлять Toncoins, даже если монеты по-прежнему заблокированы.

Get-method `get_whitelist()` возвращает все адреса в белом списке как список (wc, hash_part) трубок.

Get-method `is_whitelisted(slice address)` проверяет, есть ли этот адрес в whitelist.

`vesting_sender_address` может добавить новые адреса в белый список в любое время через сообщение `op::add_whitelist`.

Невозможно удалить адрес из белого списка.

Кроме того, заблокированные монеты всегда могут быть отправлены на `vesting_sender_address` (нет необходимости отдельно добавлять их в белый список).

## Пополнить

Вы можете отправить Toncoins на вестинговый контракт по любому адресу.

## Умный контракт на кошелек

Этот контракт разработан по аналогии с [стандартным смарт-контрактом на V3 кошелька](https://github.com/ton-blockchain/ton/blob/master/crypto/smartcont/wallet3-code.fc).

В своих данных он хранит `seqno`, `subwallet_id`, `public_key` и принимает внешние сообщения того же формата.

Доступны методы `seqno()`, `get_subwallet_id()` и `get_public_key()`.

В отличие от стандартного кошелька, заключаемый контракт позволяет отправлять только одно сообщение одновременно.

## Отправить

Владелец публичного ключа может инициировать отправку Тонкоинов с инвестиционного контракта внешним сообщением, как и в стандартных кошельках.

Отправка Toncoin также может быть инициирована внутренним сообщением `op::send` от `owner_address`.

На практике как публичный ключ, так и `owner_address` принадлежат одному пользователю.

## Ограничения белого списка

Сообщения, которые могут быть отправлены на `vesting_sender_address` имеют следующие ограничения:

- разрешено только `send_mode == 3`;

В большинстве случаев в белый список добавляются адреса, позволяющие пользователю проверять использование заблокированных монет или размещать в пулах монеты.

Во избежание кражи Тонкоинов сообщения, которые могут быть отправлены в белый список, имеют следующие ограничения:

- разрешено только `send_mode == 3`;

- разрешен только отскочиваемые сообщения;

- приложение `state_init` не разрешено;

Если назначение - адрес для выбора системы:

- только `op::elector_new_stake`, `op::elector_recover_stake`, `op::vote_for_complaint`, `op:vote_for_proposal` разрешены;

Если назначения является системным адресом конфигурации:

- только операция `op::vote_for_proposal` разрешена;

По другим направлениям:

- разрешенные пустые сообщения и пустые текстовые сообщения;
- разрешенные текстовые сообщения начинаются только с "d", "w", "D", "W";
- разрешенный `op::single_nominator_pool_withdraw`, `op::single_nominator_pool_change_validator`, `op::ton_stakers_deposit`, `op::jetton_burn`, `op::ton_stakers_vote`, `op::vote_for_proposal`, `op::vote_for_complaint`;

Адреса, не включенные в белый список, не ограничены.

Никакие ограничения не применяются при отправке разблокированных Toncoins, даже если мы отправляем в белый список или `vesting_sender_address`.

## Структура проекта

- `contracts` - исходный код всех смарт-контрактов проекта и их зависимостей.
- `wrappers` - оберточные классы (реализующие `Contract` из тона-ядра) для контрактов, включая любые примитивы [de]сериализации и функции компиляции.
- `tests` - тесты для контрактов.
- `scripts` - скрипты, используемые проектом, в основном скрипты установки.

## Как использовать

### Сборка

`npx blueprint build` или `yarn blueprint build`

### Тест

`npx blueprint test` или `yarn blueprint test`

### Установить или запустить другой скрипт

`npx blueprint run` или `yarn blueprint run`

### Добавить новый контракт

чертеж `npx создай контракт` или чертеж `yarn create ContractName`

## Смотреть также

- [Единый номенклатор](/v3/documentation/smart-contracts/contracts-specs/single-nominator-pool)
- [vesting-contract](https://github.com/ton-blockchain/vesting-contract)
