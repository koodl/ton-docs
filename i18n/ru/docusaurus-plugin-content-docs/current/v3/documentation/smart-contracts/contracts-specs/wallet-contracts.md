# Типы контрактов кошелька

Вы могли услышать о различных версиях кошельков на TON Blockchain. Но что означают эти версии и как они различаются?

В этой статье мы рассмотрим различные версии и модификации кошельков TON.

:::info
Прежде чем мы начнем, есть несколько терминов и понятий, с которыми вы должны быть знакомы для полного понимания этой статьи:

- [Управление сообщениями](/v3/documentation/smart-contracts/message-management/messages-and-transactions), поскольку это основная функциональность кошельков.
- [Язык FunC](/v3/documentation/smart-contracts/func/overview), потому что мы будем сильно полагаться на реализации, сделанные с их помощью.
  :::

## Общая концепция

Чтобы разорвать напряженность, мы должны сначала понять, что кошельки не является конкретной сущностью в экосистеме TON. Они все еще являются просто умными контрактами, состоящими из кода и данных, и в этом смысле они равны любому другому действующему лицу (i). ., умный контракт) в TON.

Как и ваш собственный смарт-контракт, или любой другой кошелёк может получать внешние и внутренние сообщения, отправьте внутренние сообщения и журналы и предоставьте "get" методы.
Итак, вопрос: какая функциональность предоставляет и как она отличается между версиями?

Каждая версия кошелька может рассматриваться как реализация смарт-контракта, обеспечивающая стандартный внешний интерфейс, Различные внешние клиенты могут взаимодействовать с кошельками таким же образом. Вы можете найти эти реализации на языках FunC и Fift в основном каталоге TON:

- [тон/crypto/smartcont/](https://github.com/ton-blockchain/ton/blob/master/crypto/smartcont/)

## Базовые кошельки

### Кошелек V1

Это самый простой вариант. Она позволяет Вам отправлять только четыре транзакции и не проверять ничего, кроме Вашей подписи и seqno.

Исходный код кошелька:

- [тон/crypto/smartcont/wallet-code.fif](https://github.com/ton-blockchain/ton/blob/master/crypto/smartcont/new-wallet.fif)

Эта версия даже не используется в обычных приложениях, так как имеет некоторые серьезные проблемы:

- Нет простого способа извлечь из контракта seqno и публичный ключ.
- Нет проверки `valid_until`, поэтому вы не можете быть уверены, что транзакция не будет подтверждена слишком поздно.

Первая проблема исправлена в `V1R2` и `V1R3`. `R` означает "ревизия". Как правило, версии - это лишь небольшие обновления, которые добавляют только методы, но вы можете найти их в истории изменений `new-wallet.fif`. Далее мы рассмотрим только последние изменения.

Тем не менее, поскольку каждая последующая версия наследует функциональность предыдущей, Мы все же должны придерживаться этого, так как это поможет нам с более поздними версиями.

#### Постоянное расположение памяти

- <b>seqno</b>: 32-битный номер длинной последовательности.
- <b>public-key</b>: 256-битный публичный ключ.

#### Внешний вид тела сообщения

1. Данные:
   - <b>подпись</b>: 512-битная подпись ed25519.
   - <b>msg-seqno</b>: 32-битный номер длинной последовательности.
   - <b>(0-4)mode</b>: для каждого сообщения определен режим отправки до четырех 8-битных целых значений.
2. До 4 ссылок на ячейки, содержащие сообщения.

Как вы можете видеть, основной функцией кошелька является обеспечение безопасного способа общения с блокчейном TON из внешнего мира. Механизм `seqno` защищает от атак повторов, а `Ed25519 signature` предоставляет авторизованный доступ к функциональности кошелька. Мы не будем подробно останавливаться на каждом из этих механизмов, как они подробно описаны в [внешнем сообщении](/v3/documentation/smart-contracts/message-management/external-messages) и довольно часто встречаются среди смарт-контрактов, получающих внешние сообщения. Данные полезной нагрузки состоят из до 4 ссылок на ячейки и соответствующего количества режимов, который будет передан непосредственно в метод [send_raw_message(ячейка msg, int mode)](/v3/documentation/smart-contracts/func/docs/stdlib#send_raw_message).

:::caution
Обратите внимание, что кошелек не проверяет подлинность отправленных через него внутренних сообщений. Это ответственность программиста (т.е. внешнего клиента) сериализовать данные в соответствии с [внутренним форматом сообщений](http://localhost:3000/v3/documentation/smart-contracts/message-management/sending-messages#message-layout).
:::

#### Коды выхода

| Код выхода | Описание                                                    |
| ---------- | ----------------------------------------------------------- |
| 0x21       | Проверка `seqno` не удалась, защита от ответа одобрена      |
| 0x22       | Ошибка проверки `Ed25519 подписи`                           |
| 0x0        | Стандартный успешный код выхода из системы. |

:::info
Note that [TVM](/v3/documentation/tvm/tvm-overview) has [standart exit codes](/v3/documentation/tvm/tvm-exit-codes) (`0x0` - is one of them), so you can get one of them too, if you run out of [gas](https://docs.ton.org/develop/smart-contracts/fees), for example, you will get `0xD` code.
:::

#### Получить способы

1. int seqno() возвращает текущий сохраненный seqno.
2. int get_public_key возвращает текущий открытый ключ.

### Кошелек V2

Исходный код кошелька:

- [ton/crypto/smartcont/wallet-code.fc](https://github.com/ton-blockchain/ton/blob/master/crypto/smartcont/wallet-code.fc)

В этой версии представлен параметр `valid_until`, , который используется для установления лимита времени для транзакции в случае, если вы не хотите, чтобы она была подтверждена слишком поздно. Эта версия также не имеет get-метода для публичного ключа, который был добавлен в `V2R2`.

Все различия по сравнению с предыдущей версией являются следствием добавления функциональности `valid_until`. Добавлен новый код выхода: `0x23`, отмечающий сбой valid_until check. Кроме того, во внешнее поле тела сообщения добавлено новое поле UNIX-времени, устанавливающее ограничение времени для транзакции. Все получают все методы остаются такими же.

#### Внешний вид тела сообщения

1. Данные:
   - <b>подпись</b>: 512-битная подпись ed25519.
   - <b>msg-seqno</b>: 32-битный номер длинной последовательности.
   - <b>valid-until</b>: 32-битное число Unix-времени.
   - <b>(0-4)mode</b>: для каждого сообщения определен режим отправки до четырех 8-битных целых значений.
2. До 4 ссылок на ячейки, содержащие сообщения.

### Кошелек V3

В этой версии представлен параметр `subwallet_id`, , которая позволяет создавать несколько кошельков с использованием одного и того же открытого ключа (так что вы можете иметь только одну seed фразу и несколько кошельков). Как и раньше, `V3R2` добавляет только метод get-доступа для публичного ключа.

Исходный код кошелька:

- [ton/crypto/smartcont/wallet3-code.fc](https://github.com/ton-blockchain/ton/blob/master/crypto/smartcont/wallet3-code.fc)

По сути, `subwallet_id` это только число, добавленное в состояние контракта после его развертывания. Поскольку адрес контракта в TON является хэшем его состояния и кода, адрес кошелька изменится с другим подкошельком_id\`. Эта версия является наиболее широко используемой в настоящее время. Он охватывает большинство вариантов использования и остается чистым, простым и в основном таким же, как и предыдущие варианты. Все получают все методы остаются такими же.

#### Постоянный макет памяти

- <b>seqno</b>: 32-битный номер последовательности.
- <b>subwallet</b>: 32-bit subwallet ID.
- <b>public-key</b>: 256-битный публичный ключ.

#### Внешняя раскладка сообщений

1. Данные:
   - <b>подпись</b>: 512-битная ed25519 подпись.
   - <b>subwallet-id</b>: 32-bit subwallet ID.
   - <b>msg-seqno</b>: 32-битное число последовательности.
   - <b>valid-until</b>: 32-битное значение UNIX времени.
   - <b>(0-4)mode</b>: До четырех 8-битных целых чисел, определяющих режим отправки для каждого сообщения.
2. До 4 ссылок на ячейки, содержащие сообщения.

#### Коды выхода

| Код выхода | Описание                                                                                 |
| ---------- | ---------------------------------------------------------------------------------------- |
| 0x23       | Ошибка проверки `valid_until`; попытка подтверждения транзакции произошла слишком поздно |
| 0x23       | Ошибка проверки `Ed25519 подписи`                                                        |
| 0x21       | `seqno` проверка не удалась; защита от ответа вызвана                                    |
| 0x22       | `subwallet-id` не соответствует хранимым                                                 |
| 0x0        | Стандартный успешный код выхода из системы.                              |

### Кошелек V4

Эта версия сохраняет всю функциональность предыдущих версий, но и представляет что-то очень мощное: `plugins`.

Исходный код кошелька:

- [ton-blockchain/wallet-contract](https://github.com/ton-blockchain/wallet-contract)

Эта функция позволяет разработчикам реализовывать сложную логику, которая работает в тандеме с пользовательским кошельком. Например, DApp может потребовать от пользователя небольшого количества монет каждый день для использования определенных функций. В этом случае пользователю нужно будет установить плагин на свой кошелек путем подписания транзакции. Плагин затем отправляет монеты на адрес назначения ежедневно, когда запрашивается внешним сообщением.

#### Плагины

Плагины по сути являются другими смарт-контрактами на TON, которые разработчики свободно реализуют по своему усмотрению. В отношении кошелька это просто адреса смарт-контрактов, хранящиеся в [dictionary](/v3/documentation/smart-contracts/func/docs/dictionaries) в постоянной памяти кошелька. Этим плагинам разрешено запрашивать средства и удалять себя из «разрешенного списка», отправляя внутренние сообщения в кошелёк.

#### Постоянное расположение памяти

- <b>seqno</b>: 32-битный номер длинной последовательности.
- <b>Субкошелек</b>: 32-битный субкошелек.
- <b>public-key</b>: 256-битный публичный ключ.
- <b>plugins</b>: словарь, содержащий плагины (может быть пустым)

#### Получение внутренних сообщений

Во всех предыдущих версиях кошельков была реализована прямая реализация для получения внутренних сообщений. Они просто принимают входящие средства от любого отправителя, игнорируя внутреннее тело сообщения, если оно существует, или другими словами, у них пустой recv_internal метод. Однако, как упоминалось ранее, четвертая версия кошелька вводит две дополнительные доступные операции. Давайте взглянем на внутренний макет тела сообщения:

- <b>op-код?</b>: 32-битный код длинной операции. Это необязательное поле; любое сообщение, содержащее менее 32 бит в теле сообщения, неверный op-код, или адрес отправителя, который не зарегистрирован в качестве плагина, будет рассматриваться как простой перевод, похожий на предыдущие версии кошелька.
- <b>query-id</b>: 64-битное целое число. Это поле не влияет на поведение смарт-контракта; оно используется для отслеживания цепочки сообщений между контрактами.

1. op-code = 0x706c7567, запрос кода операционного использования.
   - <b>toncoins</b>: VARUINT16 amount of requested toncoins.
   - <b>extra_currencies</b>: Словарь, содержащий требуемое количество дополнительных валют (может быть пустой).
2. op-code = 0x64737472, запрос на удаление отправителя плагина из "разрешенного списка".

#### Внешний вид тела сообщения

- <b>подпись</b>: 512-битная подпись ed25519.
- <b>Субкошелек id</b>: ID длинной 32-битного субкошелька.
- <b>valid-until</b>: 32-битное число Unix-времени.
- <b>msg-seqno</b>: 32-битное целое длинное.
- <b>op-code</b>: 32-битный код длинной операции.

1. op-code = 0x0, простой отправки.
   - <b>(0-4)mode</b>: для каждого сообщения определен режим отправки до четырех 8-битных целых значений.
   - <b>(0-4)сообщений</b>:Up to four ссылок на ячейки, содержащие сообщения.
2. op-code = 0x1, развертывание и установка плагина.
   - <b>workchain</b>: 8-битное целое число.
   - <b>balance</b>: VARUINT16 toncoins amount of initial balance.
   - <b>State-init</b>: Ссылка на ячейку, содержащая исходное состояние плагина.
   - <b>body</b>: Ссылки на ячейку, содержащие тело.
3. op-code = 0x2/0x3, установить плагин/удалить плагин.
   - <b>wc_n_address</b>: 8-битный длинный workchain_id + 256-битный длинный адрес плагина.
   - <b>balance</b>: VARUINT16 toncoins amount of initial balance.
   - <b>query-id</b>: 64-битное целое число.

Как вы можете видеть, четвертая версия всё ещё предоставляет стандартную функциональность через оп-код `0x0`, похожий на предыдущие версии. Операции `0x2` и `0x3` позволяют управлять плагинами словаря. Обратите внимание, что в случае `0x2` необходимо установить плагин с этим адресом самостоятельно. В отличие от этого, оп-код `0x1` также обрабатывает процесс установки с полем state_init.

:::tip
Если `state_init` не имеет большого смысла от его имени, посмотрите следующие ссылки:

- [addresses-in-ton-blockchain](/v3/documentation/smart-contracts/addresses#workchain-id-and-account-id)
- [send-a-deploy-message](/v3/documentation/smart-contracts/func/cookbook#how-to-send-a-deploy-message-with-stateinit-only-with-stateinit-and-body)
- [internal-message-layout](/v3/documentation/smart-contracts/message-management/send messages#message-layout)
  :::

#### Коды выхода

| Код выхода | Описание                                                                                                      |
| ---------- | ------------------------------------------------------------------------------------------------------------- |
| 0x24       | `valid_until` проверка не удалась, произошла ошибка подтверждения транзакции                                  |
| 0x23       | Ошибка проверки `Ed25519 подписи`                                                                             |
| 0x21       | `seqno` проверка не удалась, вызвана защита от ответа                                                         |
| 0x22       | `subwallet-id` не соответствует хранимым                                                                      |
| 0x27       | Ошибка манипуляции словарем плагинов (0x1-0x3 recv_external op-codes) |
| 0x50       | Недостаточно средств для запроса средств                                                                      |
| 0x0        | Стандартный успешный код выхода из системы.                                                   |

#### Получить способы

1. int seqno() возвращает текущий сохраненный seqno.
2. int get_public_key() возвращает текущий открытый ключ.
3. int get_subwallet_id() возвращает текущий ID субкошелька.
4. int is_plugin_installed(int wc, int addr_hash) проверяет, установлен ли плагин с определенным идентификатором и хэшем адреса.
5. tuple get_plugin_list() возвращает список плагинов.

### Кошелек V5

Это самая современная версия кошелька на данный момент, разработанная командой Tonkeeper, направленная на замену V4 и использование произвольных расширений.

Стандартный кошелек V5 предлагает много преимуществ, которые улучшают опыт как для пользователей, так и для продавцов. V5 поддерживает транзакции без газа, делегирование счетов и возмещение платежей, выплат по подписке с помощью токенов и Toncoin, а также недорогих мультипереводов. Помимо сохранения предыдущей функциональности (V4), новый контракт позволяет отправлять до 255 сообщений одновременно.

Исходный код кошелька:

- [ton-blockchain/wallet-contract-v5](https://github.com/ton-blockchain/wallet-contract-v5)

TL-B scheme:

- [ton-blockchain/wallet-contract-v5/types.tlb](https://github.com/ton-blockchain/wallet-contract-v5/blob/main/types.tlb)

:::caution
В отличие от предыдущих версий кошелька, мы будем полагаться на схему [TL-B](/v3/documentation/data-formats/tlb/tl-b-language) из-за относительной сложности реализации интерфейса этой версии кошелька. Мы предоставим некоторые описания для каждого из них. Тем не менее, базовое понимание по-прежнему требуется, в сочетании с исходным кодом кошелька, его должно быть достаточно.
:::

#### Постоянное расположение памяти

```
contract_state$_ 
    is_signature_allowed:(## 1) 
    seqno:# 
    wallet_id:(## 32) 
    public_key:(## 256) 
    extensions_dict:(HashmapE 256 int1) = ContractState;
```

Как видите, `ContractState` по сравнению с предыдущими версиями не претерпел значительных изменений. Основным отличием является новый `is_signature_allowed` 1-битный флаг, который ограничивает или разрешает доступ через подпись и сохраненный публичный ключ. Мы опишем важность этого изменения в более поздних темах.

#### Процесс аутентификации

```
signed_request$_             // 32 (opcode from outer)
  wallet_id: # // 32
  valid_until: # // 32
  msg_seqno: # // 32
  inner: InnerRequest //
  signature: bits512 // 512
= SignedRequest; Всего: 688 . 976 + ^Cell

internal_signed#73696e74 signed:SignedRequest = InternalMsgBody;

internal_extension#6578746e 
    query_id:(## 64) 
    inner:InnerRequest = InternalMsgBody;

external_signed#7369676e signed:SignedRequest = ExternalMsgBody;
```

Перед тем как перейти к фактической загрузке наших сообщений — «InnerRequest» — давайте сначала посмотрим, как версии 5 отличаются от предыдущих версий в процессе аутентификации. Комбинатор `InternalMsgBody` описывает два способа доступа к действиям кошелька через внутренние сообщения. Первым методом является то, что мы уже знакомы с версией 4: аутентификация как ранее зарегистрированное расширение, адрес которого хранится в файле `extensions_dict`. Второй метод - аутентификация через хранимый открытый ключ и подпись, похожие на внешние запросы.

Сначала это может показаться ненужной функцией, но он позволяет обрабатывать запросы через внешние сервисы (смарт-контракты), которые не являются частью инфраструктуры расширений вашего кошелька – ключевая особенность V5. Транзакции, свободные от газа, основаны на этой функциональности.

Обратите внимание, что просто получение средств все еще является вариантом. Практически любое полученное внутреннее сообщение, которое не проходит процесс аутентификации, будет считаться передачей.

#### Действия

Первое, что нам следует заметить, - это «InnerRequest», который мы уже видели в процессе аутентификации. В отличие от предыдущей версии, внешние и внутренние сообщения имеют доступ к одной функциональности, за исключением изменения режима подписи (i). , флаг `is_signature_allowed`).

```
out_list_empty$_ = Исходящий список 0;
out_list$_ {n:#} 
    prev:^(OutList n) 
    action:OutAction = OutList (n + 1);

action_send_msg#0ec3c86d режим:(## 8) out_msg:^(MessageRelaxed Any) = Исходящее действие;

// Расширенные действия в V5:
action_list_basic$_ {n:#} actions:^(OutList n) = ActionList n 0;
action_list_extended$_ {m:#} {n:#} action:ExtendedAction prev:^(ActionList n m) = ActionList n (m+1);

action_add_ext#02 addr:MsgAddressInt = ExtendedAction;
action_delete_ext#03 addr:MsgAddressInt = ExtendedAction;
action_set_signature_auth_allowed#04 allowed:(## 1) = ExtendedAction;

действий$_ out_actions:(Maybe OutList) has_other_actions:(## 1) {m:#} {n:#} other_actions:(ActionList n m) = InnerRequest;
```

Мы можем рассматривать «InnerRequest» как два списка действий: первый «OutList», — необязательная цепочка ссылок на ячейки, каждая из которых содержит запрос на отправку сообщения, ведущий в режиме сообщения. Второе, «ActionList» ведёт один битный флаг, «has_other_actions», который обозначает наличие расширенных действий, от первой ячейки и продолжать как цепочку ссылок на ячейки. Мы уже знакомы с первыми двумя расширенными действиями, `action_add_ext` и `action_delete_ext`, далее внутренний адрес, который мы хотим добавить или удалить из словаря расширений. Третий, `action_set_signature_auth_allowed`, ограничивает или разрешает аутентификацию через публичный ключ, оставляя единственный способ взаимодействовать с кошельком через расширения. Эта функциональность может быть чрезвычайно важной в случае утерянного или скомпрометированного закрытого ключа.

:::info
Note that the maximum number of actions is 255; this is a consequence of the realization through the [c5](/v3/documentation/tvm/tvm-overview#result-of-tvm-execution) TVM register. Технически вы можете сделать запрос с пустым «OutAction» и «ExtendedAction», но в этом случае он будет похож на просто получаемые средства.
:::

#### Коды выхода

| Код выхода | Описание                                                                                                                         |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------- |
| 0x84       | Попытка аутентификации через подпись, когда она отключена                                                                        |
| 0x85       | `seqno` проверка не удалась, произошла защита от ответа                                                                          |
| 0x86       | `wallet-id` не соответствует хранилищу                                                                                           |
| 0x87       | Ошибка проверки `Ed25519 подписи`                                                                                                |
| 0x88       | Ошибка проверки `valid-until`                                                                                                    |
| 0x89       | Убедитесь, что в `send_mode` установлен +2 бит (игнорировать ошибки), для внешнего сообщения. |
| 0x8A       | Префикс `external-signed` не соответствует полученному                                                                           |
| 0x8B       | Ошибка при добавлении расширения                                                                                                 |
| 0x8C       | Не удалось удалить расширение                                                                                                    |
| 0x8D       | Неподдерживаемый расширенный префикс сообщений                                                                                   |
| 0x8E       | Попытка отключить авторизацию подписью, пока словарь расширений пуст                                                             |
| 0x8F       | Попытка установить подпись на уже установленное состояние                                                                        |
| 0x90       | Попытка удалить последнее расширение, когда подпись отключена                                                                    |
| 0x91       | У расширения неправильная цепочка работ                                                                                          |
| 0x92       | Попытка изменить режим подписи через внешнее сообщение                                                                           |
| 0x93       | Ошибка проверки `c5`, `action_send_msg`                                                                                          |
| 0x0        | Стандартный успешный код выхода из системы.                                                                      |

:::danger
Обратите внимание, что коды выхода кошелька `0x8E`, `0x90` и `0x92` предназначены для предотвращения потери доступа к функциональности кошелька. Тем не менее, вы все еще должны помнить, что кошелек не проверяет действительно ли сохраненные адреса расширений существуют в TON. Вы также можете развернуть кошелек с исходными данными, состоящими из пустого словаря расширений и режима ограничения подписи. В этом случае вы по-прежнему сможете получить доступ к кошельку через открытый ключ, пока вы не добавите первое расширение. Итак, будьте осторожны с этими сценариями.
:::

#### Получить способы

1. int is_signature_allowed() возвращает сохраненный флаг `is_signature_allowed`.
2. int seqno() возвращает текущий сохраненный seqno.
3. int get_subwallet_id() возвращает текущий ID субкошелька.
4. int get_public_key() возвращает текущий открытый ключ.
5. ячейка get_extensions() возвращает словарь расширений.

#### Подготовка к сделкам с газом

Как и было грустно до v5 кошелька смарт-контракт позволяет обрабатывать внутренние сообщения, подписанные владельцем. Это также позволяет совершать безналичные транзакции, например, оплачивать сетевые сборы при передаче USDt в долларах США. Общая схема выглядит следующим образом:

![image](/img/gasless.jpg)

:::tip
Следовательно, будут доступны сервисы (например, [батарея Тонкипера](https://blog.ton. rg/tonkeeper-releases-huge-update#tonkeeper-battery)), которые предоставляют эту функцию: они платят сборы за транзакции в ТОН от имени пользователя, но взимают плату в токенах.
:::

#### Поток

1. При отправке USDT пользователь подписывает одно сообщение, содержащее два исходящих перевода USDt:
   1. USDt перевод на адрес получателя.
   2. Перевод небольшой суммы USDt в пользу Услуги.
2. Это подписанное сообщение отправляется по HTTPS бэкэнду Сервиса. Бэкенд службы отправляет его в блокчейн TON, платив Toncoins за сетевые комиссии.

Бета-версия gasless backend API доступна в [tonapi.io/api-v2](https://tonapi.io/api-v2). Если вы разрабатываете какое-либо приложение для кошелька и имеете обратную связь по этим методам, поделитесь им на [@tonapitech](https://t.me/tonapitech) чат.

Исходный код кошелька:

- [ton-blockchain/wallet-contract-v5](https://github.com/ton-blockchain/wallet-contract-v5)

## Специальные кошельки

Иногда функции базовых кошельков недостаточно. Вот почему существует несколько типов специализированных кошельков: `high-load`, `lockup` и `restricted`.

Давайте посмотрим на них.

### Highload кошельки

При работе с большим количеством сообщений за короткий период возникает потребность в специальном кошельке под названием Highload Wallet. Прочитайте [статью](/v3/documentation/smart-contracts/contracts-specs/highload-wallet) для получения дополнительной информации.

### Заблокировать кошелек

Если вы, по какой-либо причине, должны некоторое время заблокировать монеты в кошельке без возможности их снятия до того времени, посмотрите на кошелек блокировки.

Он позволяет вам установить время, до которого вы не сможете ничего вывести из кошелька. Вы также можете настроить его, установив периоды разблокировки, так что вы сможете потратить немного монет в эти заданные периоды.

Например: вы можете создать кошелек, который будет содержать 1 миллион монет с общим весом 10 лет. Установите длительность клипа на один год, так что средства будут заблокированы в течение первого года после создания кошелька. Затем вы можете установить период разблокировки на один месяц, так что `1'000'000 TON / 120 месяцев = ~8333 TON` будет разблокироваться каждый месяц.

Исходный код кошелька:

- [ton-blockchain/lockup-wallet-contract](https://github.com/ton-blockchain/lockup-wallet-contract)

### Ограниченный кошелек

Функция этого кошелька состоит в том, чтобы действовать как обычный кошелек, но ограничить переводы только одним заранее определенным адресом назначения. Вы можете задать место назначения при создании этого кошелька, а затем перевести средства с него на этот адрес. Однако обратите внимание, что вы все еще можете переводить средства на утверждение контрактов, чтобы вы могли запустить валидатор с этим кошельком.

Исходный код кошелька:

- [EmelyanenkoK/nomination-contract/restricted-wallet](https://github.com/EmelyanenkoK/nomination-contract/tree/master/restricted-wallet)

## Известные оп-коды

:::info
Также op-code, op::code и операционный код
:::

| Тип контракта  | Шестнадцатеричный код | OP::Code                                                                                                    |
| -------------- | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| Глобально      | 0x00000000            | Текстовый комментарий                                                                                                                       |
| Глобально      | 0xffffff              | Отскок                                                                                                                                      |
| Глобально      | 0x2167da4b            | [Зашифрованный комментарий](/v3/documentation/smart-contracts/message-management/internal-messages#messages-with-encrypted-comments)        |
| Глобально      | 0xd53276db            | Облики                                                                                                                                      |
| Электрик       | 0x4e73744b            | Новая пикет                                                                                                                                 |
| Электрик       | 0xf374484c            | Подтверждение нового пикета                                                                                                                 |
| Электрик       | 0x47657424            | Восстановить запрос разбивки                                                                                                                |
| Электрик       | 0x47657424            | Восстановить ответ на пикет                                                                                                                 |
| Кошелек        | 0x0f8a7ea5            | Перевод Jetton                                                                                                                              |
| Кошелек        | 0x235caf52            | [Jetton Call To](https://testnet.tonviewer.com/transaction/1567b14ad43be6416e37de56af198ced5b1201bb652f02bc302911174e826ef7)                |
| Джеттон        | 0x178d4519            | Jetton Внутренний Передача                                                                                                                  |
| Джеттон        | 0x7362d09c            | Jetton Notify                                                                                                                               |
| Джеттон        | 0x595f07bc            | Джеттон Берн                                                                                                                                |
| Джеттон        | 0x7bdd97de            | Уведомление Jetton Burn                                                                                                                     |
| Джеттон        | 0xeed236d3            | Статус Jetton Set                                                                                                                           |
| Джеттон-Шахтёр | 0x642b7d07            | Джеттон Мятт                                                                                                                                |
| Джеттон-Шахтёр | 0x6501f354            | Менеджер изменения Jetton                                                                                                                   |
| Джеттон-Шахтёр | 0xfb88e119            | Jetton Claim Admin                                                                                                                          |
| Джеттон-Шахтёр | 0x7431f221            | Админ Jetton Drop                                                                                                                           |
| Джеттон-Шахтёр | 0xcb862902            | Метаданные изменения Jetton                                                                                                                 |
| Джеттон-Шахтёр | 0x2508d66a            | Обновление Jetton                                                                                                                           |
| Вестинг        | 0xd372158c            | [Поверх всех](https://github.com/ton-blockchain/liquid-staking-contract/blob/be2ee6d1e746bd2bb0f13f7b21537fb30ef0bc3b/PoolConstants.ts#L28) |
| Вестинг        | 0x7258a69b            | Добавить белый список                                                                                                                       |
| Вестинг        | 0xf258a69b            | Добавить ответ в белый список                                                                                                               |
| Вестинг        | 0xa7733acd            | Отправить                                                                                                                                   |
| Вестинг        | 0xf7733acd            | Отправить ответ                                                                                                                             |
| Пыль           | 0x9c610de3            | Выход из пыли                                                                                                                               |
| Пыль           | 0xe3a0d482            | Вкус пыли Jetton                                                                                                                            |
| Пыль           | 0xea06185d            | Внутренняя замена пыли                                                                                                                      |
| Пыль           | 0x61ee542d            | Поменять внешний вид                                                                                                                        |
| Пыль           | 0x72aca8aa            | Поменять местами пира                                                                                                                       |
| Пыль           | 0xd55e4686            | Внутренняя ликвидность пополнения                                                                                                           |
| Пыль           | 0x40e108d6            | Jetton для пополнения счета                                                                                                                 |
| Пыль           | 0xb56b9598            | Пополнить всю ликвидность                                                                                                                   |
| Пыль           | 0xad4eb6f5            | Оплатить из пула                                                                                                                            |
| Пыль           | 0x474а86са            | Выплата                                                                                                                                     |
| Пыль           | 0xb544f4a4            | Пополнение                                                                                                                                  |
| Пыль           | 0x3aa870a6            | Вывод средств                                                                                                                               |
| Пыль           | 0x21cfe02b            | Создать сейф                                                                                                                                |
| Пыль           | 0x97d51f2f            | Создать Volatile Пул                                                                                                                        |
| Пыль           | 0x166cedee            | Отменить депозит                                                                                                                            |
| StonFi         | 0x25938561            | Поменять местами                                                                                                                            |
| StonFi         | 0xf93bb43f            | Запрос платежа                                                                                                                              |
| StonFi         | 0xfcf9e58f            | Обеспечить ликвидность                                                                                                                      |
| StonFi         | 0xc64370e5            | Успешный обмен                                                                                                                              |
| StonFi         | 0x45078540            | Успешный обмен                                                                                                                              |

:::info
[Документы из пыли](https://docs.dedust.io/docs/swaps)

[Документы StonFi](https://docs.ston.fi/docs/developer-section/architecture#calls-descriptions)
:::

## Заключение

Как вы видите, в TON есть много различных версий кошельков. Но в большинстве случаев вам нужны только `V3R2` или `V4R2`. Вы также можете использовать один из специальных кошельков, если хотите иметь дополнительные функции, такие как периодическая разблокировка средств.

## Смотреть также

- [Работа с Smart Contracts](/v3/guidelines/smart-contracts/howto/wallet)
- [Источники базовых кошельков](https://github.com/ton-blockchain/ton/tree/master/crypto/smartcont)
- [Более техническое описание версий](https://github.com/toncenter/tonweb/blob/master/src/contract/wallet/WalletSources.md)
- [Кошелек V4 и подробное описание](https://github.com/ton-blockchain/wallet-contract)
- [Заблокировать источники и подробное описание](https://github.com/ton-blockchain/lockup-wallet-contract)
- [Ограниченные источники кошелька](https://github.com/EmelyanenkoK/nomination-contract/tree/master/restricted-wallet)
- [Беспроводные транзакции на TON](https://medium.com/@buidlingmachine/gasless-transactions-on-ton-75469259eff2)
