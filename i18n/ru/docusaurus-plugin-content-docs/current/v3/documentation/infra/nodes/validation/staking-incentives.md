# Разбивка стимулов

## Выборы и разбивка

TON Blockchain использует алгоритм согласования с долей (PoS) , что означает, как и все сети PoS, что безопасность и стабильность сети поддерживаются множеством сетевых валидаторов. В частности, валидаторы предлагают кандидатов на новые блоки (состоящие из команд транзакций), в то время как другие валидаторы _validate_ и одобряют их с помощью цифровых подписей.

Валидаторы выбираются по специальному [контракту по управлению электорами](/v3/documentation/smart-contracts/contracts-specs/governance#elector). В ходе каждого раунда консенсуса, кандидаты посылают заявку на избрание вместе со своей долей и желаемым _max_factor_ (параметр, который регулирует количество поддержки, которое проверяющий выполняет за каждый раунд консенсуса).

В ходе процесса выборов для проверки кандидатов, умный контракт управления выбирает следующий раунд валидаторов и присваивает каждому валидатору вес для максимизации своей общей доли, также принимая во внимание долю валидатора и _max_factor_. В этом отношении, чем выше ставка и _max_factor_, тем больше вес голоса валидатора и наоборот.

Избранные валидаторы выбираются для обеспечения безопасности сети путем участия в следующем раунде консенсуса. Однако, в отличие от многих других блокчейнов, для достижения горизонтальной масштабируемости, каждый валидатор проверяет только часть сети:

Для каждого шардинга и шедевра существует специальный набор валидаторов. Наборы валидаторов masterchain состоят из до 100 валидаторов с наибольшим весом голоса (определяется как `Config16:max_main_validators`).

Напротив, каждый шардцепь проверяется набором из 23 валидаторов (определен как `Config28:shard_validators_num`) и поворачивается случайным образом каждые 1000 секунд (Сетевой параметр `Config28:shard_validators_lifetime`).

## Значения пикетов: максимальный уровень

Текущий `max_factor` в конфигурации **3**, означает, что доля валидатора _smallest_ не может быть больше чем в три раза меньше, чем ставка _largest_ одного.

Формула с параметрами конфигурации:

`max_factor` = [`max_stake_factor`](https://tonviewer.com/config#17) / [`validators_elected_for`](https://tonviewer.com/config#15)

### (упрощенный) Алгоритм выделения

Этот алгоритм, выполняемый [умным контрактом электора](/v3/documentation/smart-contracts/contracts-specs/governance#elector), выбирает лучших кандидатов для валидации, основанных на той доле, которую они взяли. Вот разбивка того, как она работает:

1. **Initial Selection**: Elector considers all candidates who have staked more than a set minimum amount (300K, as specified in the [configuration](https://tonviewer.com/config#17)).

2. **Порядок кандидатов**: Эти кандидаты будут распределены от наивысшего до наименьшего.

3. **сужение вниз**:
   - Если количество кандидатов превышает максимально допустимое число валидаторов [см. конфигурацию](https://tonviewer.com/config#16)), исключаются те, кто имеет наименьшие ставки.
   - Затем электродвигатель оценивает каждую потенциальную группу кандидатов, начиная от самой большой группы и заканчивая меньшими:
     - Он исследует лучших кандидатов в заказанном списке, увеличивая число 1 на один.
     - Для каждого кандидата Избиратель рассчитывает свою "эффективную ставку". Если доля кандидата значительно выше, чем минимальная, то она корректируется вниз (т.е. если кто-то поставил 310k и минимум 100k, но существует ограничение в три раза минимальное, их эффективность считается 300к).
     - Он подытоживает реальную долю всех кандидатов в этой группе.

4. **Окончательная выборка**: Группа кандидатов с наивысшей эффективностью выбирается избирателями в качестве кандидатов.

#### Алгоритм выбора валидатора

На основе доступных ставок потенциальных валидаторов определяются оптимальные значения для минимальной и максимальной доли, с целью максимизации величины всего товара:

1. Избиратель принимает на себя всех кандидатов, у которых минимальная ставка выше минимальной ([300K в конфигурации](https://tonviewer.com/config#17)).
2. Избиратель сортирует их по _убыванию_ порядку.
3. Если больше участников больше, чем [максимальное число](https://tonviewer.com/config#16) валидаторов, то электор сбрасывает хвост списка. Затем электродвигатель делает следующее:

   - Для каждого цикла **i** от _1 до N_ (оставшееся количество участников) принимает первые **i** приложения из отсортированного списка.
   - Он рассчитывает эффективную долю с учетом `max_factor`. То есть, если человек поместил 310k, но с `max_factor` в 3, и минимальная ставка в списке - 100 тысяч Тонкоинов, то эффективная ставка будет min(310k, 3\*100k) = 300k. Один узел валидатора может использовать до 600k TON (в данном примере) в двух раундах (половина нечетных раундов, половина четных раундов). Для увеличения ставки необходимо настроить несколько узлов валидатора.
   - На него рассчитывается эффективная доля всех участников **i**.

Как только электор найдет **i**, где эффективная цена является максимальной, мы объявляем этих участников **i** валидаторами.

## Положительные стимулы

Аналогично всем сетям блокчейн, для каждой транзакции TON требуется комиссия за вычисление под названием [gas](https://blog. on.org/what-is-blockchain) используется для хранения данных и обработки транзакций. На TON, эти комиссии накапливаются в рамках договора электродвигателя в пуле вознаграждений.

Сеть также субсидирует создание блоков, добавляя субсидию в фонд вознаграждений равный 1. TON для каждого блока шедевров и 1 TON для каждого базового блока (Сетевые параметры `Config14:masterchain_block_fee` и `Config14:basechain_block_fee`). Обратите внимание, что при разделении базиса на несколько шардингов субсидия на шардинг разделяется соответствующим образом. Этот процесс позволяет хранить субсидию на единицу времени рядом с постоянным.

:::info
В июне 2023 года был введен [Deflationary Burn Mechanism](https://blog.ton.org/ton-holders-and-validators-vote-in-favor-of-implementing-the-toncoin-real-time-burn-mechanism). С помощью этого механизма часть TON, генерируемого сетью, сжигается, а не выделяется для фонда вознаграждений.
:::

После цикла валидации продолжительностью 65536 секунд или примерно 18 часов (Сетевой параметр `Config15:validators_elected_for`), staked TON не немедленно выпущен каждым валидатором, а удерживается дополнительно 32768 секунд или ~9 часов (Сетевой параметр `Config15:stake_held_for`). В течение этого периода штрафные санкции могут быть вычтены из валидатора. После того, как средства будут освобождены, валидаторы могут отозвать свою долю вместе с долей фонда вознаграждения, начисленной во время раунда проверки пропорционально их голосованию _веса_.

По состоянию на апрель 2023 года общий фонд вознаграждений за каждый раунд консенсуса для всех участников сети составляет приблизительно 40 000 TON, при среднем вознаграждении за валидатор ~ 120 TON (максимальная разница между весом голоса и начисленными наградами составляет ~3 TON).

С учетом общего объема поставок Тонкона (5 миллиардов тонн) темпы инфляции составляют примерно 0,3-0,6% ежегодно.

Однако эта инфляция не всегда постоянна и может отклоняться в зависимости от текущего состояния сети. В конце концов, он будет иметь тенденцию дефляции после активации механизма дефляции и увеличения использования сети.

:::info
Изучите текущую статистику TON Blockchain [here](https://tontech.io/stats/).
:::

## Отрицательные стимулы

В TON Blockchain, как правило, существуют два способа наказания для валидаторов за неправильное поведение: простое и злонамеренное неправомерное поведение; Оба из которых запрещены и могут приводить к штрафу (в процессе называемого "рационализатора") за их действия.

Если валидатор не участвует в создании блоков и подписании транзакций на значительное количество времени во время раунда валидации, потенциально он может оштрафован с помощью параметра _Standard fine_. По состоянию на апрель 2023 года штраф в размере 101 TON (Сетевой параметр `ConfigParam40:MisbehaviorPunishmentConfig`).

В ТОН, наложение штрафов (штрафных санкций для валидаторов) позволяет любому участнику сети подать жалобу, если они считают, что валидатор неправильно выполняет. В ходе этого процесса участник, издающий жалобу, должен приложить для подачи электоральной информации криптографические доказательства неправомерного поведения. В период разрешения споров `stake_held_for`, Все валидаторы, работающие в сети, проверяют обоснованность жалоб и голосуют, будут ли они коллективно рассматривать жалобу (при определении законности неверных доказательств и мелких ассигнований).

По достижении 66% утверждений валидатора (измеряется равным весом голоса), штраф вычитается из валидатора и отзывается из общей доли валидатора. Процесс проверки наказаний и разрешения жалоб обычно проводится автоматически с помощью MyTonCtrl.

## Децентрализованная система наказаний

:::info
Нижеследующая система наказания плохо работающих валидаторов полностью функционирует 9 сентября 2024 года.
:::

### Определение неудовлетворительной работы

TON поставляется с утилитой [lite-client](https://github.com/newton-blockchain/ton/tree/master/lite-client). В lite-клиенте есть команда `checkloadall`.
Эта команда анализирует количество блоков валидатора и их количество фактически обрабатывается за определенный период времени.

Если валидатор обрабатывает менее 90% от ожидаемого количества блоков во время раунда проверки, Считается, что он плохо работает и должен быть наказан.
::info
Подробнее о техническом описании процесса [here](https://github.com/ton-blockchain/TIPs/issues/13#issuecomment-786627474)
:::

### Жалоба рабочего процесса

- Каждый может подать жалобу и получить вознаграждение по правильной жалобе.
- Проверка жалоб Валидаторов и полностью децентрализована.

#### Сделать жалобу

После каждого раунда проверки (~18 часов), валидатор ставки валидаторов, участвовавших в этом раунде, на умный контракт электродвигателя еще на 9 часов.
В течение этого времени каждый может подать жалобу против валидатора, который плохо выступил в указанном раунде. Это происходит в цепи смарт-контракта Elector.

#### Проверка жалобы

После каждого раунда проверки валидаторы получают список жалоб от электродвигателя смарт-контракта и дважды проверяют их путем вызова `checkloadall`.
В случае утверждения жалобы они проводят по цепочке голосования в пользу этой жалобы.

Эти действия встроены в `mytonctrl` и происходят автоматически.
Если жалоба имеет 66% голосов валидаторов (по их весу), из долей валидатора отмирает штраф.
Никто не может самостоятельно оштрафовать.

[@tonstatus_notifications](https://t.me/tonstatus_notifications) - список штрафных валидаторов каждого раунда.

### Прекрасное значение

Размер штрафа фиксируется и равняется 101 TON(Сетевой параметр `ConfigParam40:MisbehaviourPunishmentConfig`), который примерно равен доходу валидатора за раунд.

Значение отсева может измениться, В связи с тем, что аудитория и количество сделок в TON стремительно растут, и очень важно, чтобы качество работы было в лучшем случае.

### Точное распределение

Штраф распределяется между валидаторами сети минус стоимость сети и небольшая награда (~8 TON) первому заявителю, который отправил правильную жалобу на электора.

### Руководства по валидации

Чтобы не допустить проверки узла, рекомендуется убедиться в том, что аппаратное обеспечение, мониторинг и валидатор правильно настроены.
Пожалуйста, убедитесь, что вы соответствуете [правилам для валидации](/v3/guidelines/nodes/running-nodes/validator-node#maintain-guidelines).
Если вы не хотите делать это, пожалуйста, рассмотрите возможность использования сервисов разработчиков https://ton.org/stake.

## Смотреть также

- [Запуск валидатора](/v3/guidelines/nodes/running-nodes/validator-node)
- [Плата за транзакцию](/v3/documentation/smart-contracts/transaction-fees/fees)
- [Что такое блокчейн? Что такое умный контракт? Что такое газ?](https://blog.ton.org/what-is-blockchain)
