import ThemedImage from '@theme/ThemedImage';

# Пятый Оракл

## Как использовать данные в реальном времени в контрактах TON

Пять ценовых фидов на TON управляются с помощью основного контракта TON Pyth
, что обеспечивает плавное взаимодействие с данными по цепочке. In TON,
these interactions are facilitated by specific functions within the
Pyth receiver contract. Этот контракт выступает в качестве интерфейса к фидам цен на Pyth
и обрабатывает поиск и обновление данных о ценах.

## Установите Pyth SDK

Установите Pyth TON SDK и другие необходимые зависимости с помощью npm или пряжки:

```ts
   npm install @pythnetwork/pyth-ton-js @pythnetwork/hermes-client
   @ton/core @ton/ton @ton/crypto
```

   или

```ts
   yarn add @pythnetwork/pyth-ton-js @pythnetwork/hermes-client
   @ton/core @ton/ton @ton/crypto
```

## Написать код клиента

Следующий фрагмент кода демонстрирует, как получать обновления цен, взаимодействовать с контрактом Pyth на TON, и обновлять ценовые фиды:

- TON Mainnet: [EQBU6k8HH6yX4Jf3d18swWbnYr31D3PJI7PgjXT-flsKHqql](https://docs.pyth.network/price-feeds/contract-addresses/ton)
- TON Testnet: [EQB4ZnrI5qsP_IUJgVJNwEGKLzZWsQOFhiaqDbD7pTt_f9oU](https://docs.pyth.network/price-feeds/contract-addresses/ton)

В следующем примере используется testnet контракт. Для использования mainnet измените `PYTH_CONTRACT_ADDRESS_TESTNET` на `PYTH_CONTRACT_ADDRESS_MAINNET`. 

```ts
импортировать { TonClient, Address, WalletContractV4 } из "@ton/ton";
импортировать { toNano } из "@ton/core";
импортировать { mnemonicToPrivateKey } из "@ton/crypto";
импортировать { HermesClient } из "@pythnetwork/hermes-client";
import {
  PythContract,
  PYTH_CONTRACT_ADDRESS_TESTNET,
  calculateUpdatePriceFeedsFee,
} с "@pythnetwork/pyth-ton-js";
const BTC_PRICE_FEED_ID =
  "0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43";
async function main() {
  // Инициализация TonClient
  const client = new TonClient({
    endpoint: "https://testnet. центр. om/api/v2/jsonRPC",
    apiKey: "your-api-key-here", // Optional
  });
  // Создание экземпляра PythContract
  const contractAddress = Address. arse(PYTH_CONTRACT_ADDRESS_TESTNET);
  const contract = client.open(PythContract.createFromAddress(contractAddress));
  // Получить индекс текущего хранителя
  const guardianSetIndex = await contract. etCurrentGuardianSetIndex();
  консоли. og("Индекс хранителя:", guardianSetIndex);
  // Получить цену BTC от TON контракта
  const цена = ожидание контракта. etPriceUnsafe(BTC_PRICE_FEED_ID);
  консоли. og("Цена BTC от TON contract:", price);
  // Получение последних обновлений цен от Hermes
  const hermesEndpoint = "https://hermes. yth.network";
  const hermesClient = новый HermesClient(hermesEndpoint);
  const priceIds = [BTC_PRICE_FEED_ID];
  constlatestPriceUpdates = ожидание клиента hermesent. etLatestPriceUpdates(
    priceIds,
    { encoding: "hex" }
  );
  консоли. og("Цена BTC Гермес:", latestPriceUpdates.[0].price);
  // Подготовка данных обновления
  const updateData = Buffer.from(latestPriceUpdates.binary.data[0], "hex");
  консоли. og("Данные обновления:", updateData);
  // Получение платы за обновление
  const updateFee = await contract.getUpdateFee(updateData);
  консоли. og("Плата обновления:", updateFee);
  совпало с общей комиссией =
    рассчитано Прайс-FeedsFee(BigInt(updateFee)) + BigInt(updateFee);
  // Обновление ценовых фидов
  const mnemonic = "Ваш мнемонический здесь";
  const key = await mnemonicToPrivateKey(mnemonic. plit(" "));
  const кошелек = WalletContractV4. reate({
    publicKey: key.publicKey,
    workchain: 0,
  });
  const provider = client.open(кошелек);
  await contract.sendUpdatePriceFeeds(
    provider.sender(key. ecretKey),
    updateData,
    totale
  );
  консоли. og("Ленты цен успешно обновлены.");
}
main().catch(console.error);
```

Этот фрагмент кода делает следующее:

1. Инициализирует «TonClient» и создает экземпляр «PythContract».
2. Возвращает из контракта TON индекс действующего хранителя и цену BTC.
3. Получает последние обновления цен от Hermes.
4. Подготавливает обновленные данные и рассчитывает плату за обновление.
5. Обновляет ценовые фиды на контракте TON.

## Дополнительные ресурсы

Вы можете найти эти дополнительные ресурсы, полезные для разработки вашего TON-приложения:

- [TON документация](https://ton.org/docs/)
- [Pyth Price Feed IDs](https://pyth.network/developers/price-feed-ids)
- [Pyth TON Contract](https://github.com/pyth-network/pyth-crosschain/tree/main/target_chains/ton/contracts)
- [Pyth TON SDK](https://github.com/pyth-network/pyth-crosschain/tree/main/target_chains/ton/sdk)
- [Pyth TON Пример](https://github.com/pyth-network/pyth-examples/tree/main/price_feeds/ton/sdk_js_usage)
